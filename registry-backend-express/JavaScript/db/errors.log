

15:45:09 error: duplicate key value violates unique constraint "group_subs_pkey"
         tx(accept-invite): INSERT INTO group_subs (sub,group_manager,group_id) VALUES('4359841657275796f20734f26d7b60c515f17cd36bad58d29ed87d000d621974@egi.eu',false,7) RETURNING sub

15:45:09 error: current transaction is aborted, commands ignored until end of transaction block
         tx(accept-invite): DELETE FROM invitations WHERE id=4 AND sub='4359841657275796f20734f26d7b60c515f17cd36bad58d29ed87d000d621974@egi.eu' RETURNING id

09:45:34 error: the database system is shutting down
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

08:36:35 error: connect ECONNREFUSED ::1:5432
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

06:16:22 error: syntax error at or near "AND"
         query: SELECT preferred_username as username, email, group_manager, false as pending,group_id,sub,Null::INTEGER as invitation_id,NULL::TIMESTAMP WITHOUT TIME ZONE as invitation_date FROM ((SELECT sub, group_manager,group_id FROM group_subs WHERE group_id=5) as foo LEFT JOIN user_info USING (sub)) UNION SELECT preferred_username as username, foo.email, group_manager, true as pending,group_id,sub,invitation_id,date as invitation_date FROM ((SELECT sub, group_manager,email,group_id,id as invitation_id,date FROM invitations WHERE group_id=5 AND AND EXTRACT(EPOCH FROM '2020-09-11T06:16:22.301+03:00' - date)<2592000 ) as foo LEFT JOIN user_info USING (sub))

06:51:04 error: duplicate key value violates unique constraint "group_subs_pkey"
         tx(accept-invite): INSERT INTO group_subs (sub,group_manager,group_id) VALUES('7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu',false,1) RETURNING sub

06:51:04 error: current transaction is aborted, commands ignored until end of transaction block
         tx(accept-invite): DELETE FROM invitations WHERE id=4 AND sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu' RETURNING id

18:41:01 error: the database system is shutting down
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

23:26:37 error: the database system is shutting down
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

23:40:01 error: terminating connection due to administrator command
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

20:29:39 error: column "name" does not exist
         query: SELECT name,logo,main_title,color FROM tenants WHERE name='egi'

22:55:52 error: relation "service_details" does not exist
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN owned IS NULL THEN false ELSE owned END,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,deleted,comment,group_id FROM (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details WHERE tenant='egi') AS service_details LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu') AS group_ids USING (group_id) LEFT JOIN (SELECT id AS petition_id,status,type,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification, service_id,comment FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu' THEN true ELSE false END AS owned,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,notification,deleted,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,comment,service_description,logo_uri,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,status,type,null AS state,false AS deleted,group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='egi') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu'

23:00:43 error: relation "service_petition_details" does not exist
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN owned IS NULL THEN false ELSE owned END,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,deleted,comment,group_id FROM (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details WHERE tenant='egi') AS service_details LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu') AS group_ids USING (group_id) LEFT JOIN (SELECT id AS petition_id,status,type,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification, service_id,comment FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu' THEN true ELSE false END AS owned,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,notification,deleted,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,comment,service_description,logo_uri,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,status,type,null AS state,false AS deleted,group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='egi') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu'

09:46:15 error: connect ECONNREFUSED ::1:5432
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

09:46:21 error: connect ECONNREFUSED ::1:5432
         connection: {"host":"localhost","port":5432,"database":"service_registry_db","user":"postgres","password":"########"}

09:54:31 error: No data returned from the query.
         task(deploymentResults): DELETE FROM tokens WHERE code='54d27fd0-f8b2-11ea-a1b0-511fd4b6876c' RETURNING code

13:49:36 error: syntax error at or near "AND"
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,deleted,CASE WHEN owned IS NULL THEN false ELSE owned END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,comment,group_id FROM (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu') AS group_ids LEFT JOIN (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details AND tenant='eosc') AS service_details USING (group_id) LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS petition_id,status,type, service_id,comment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,deleted,owned,notification,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,service_description,logo_uri,comment,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,CASE WHEN requester='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu' THEN true ELSE false END AS owned,status,type,null AS state,false AS deleted, group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='eosc') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu'

13:49:54 error: syntax error at or near "AND"
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,deleted,CASE WHEN owned IS NULL THEN false ELSE owned END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,comment,group_id FROM (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu') AS group_ids LEFT JOIN (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details AND tenant='eosc') AS service_details USING (group_id) LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS petition_id,status,type, service_id,comment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,deleted,owned,notification,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,service_description,logo_uri,comment,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,CASE WHEN requester='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu' THEN true ELSE false END AS owned,status,type,null AS state,false AS deleted, group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='eosc') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu'

13:49:56 error: syntax error at or near "AND"
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,deleted,CASE WHEN owned IS NULL THEN false ELSE owned END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,comment,group_id FROM (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu') AS group_ids LEFT JOIN (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details AND tenant='eosc') AS service_details USING (group_id) LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS petition_id,status,type, service_id,comment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,deleted,owned,notification,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,service_description,logo_uri,comment,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,CASE WHEN requester='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu' THEN true ELSE false END AS owned,status,type,null AS state,false AS deleted, group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='eosc') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu'

13:55:22 error: syntax error at or near "AND"
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,deleted,CASE WHEN owned IS NULL THEN false ELSE owned END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,comment,group_id FROM (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu') AS group_ids LEFT JOIN (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details AND tenant='eosc') AS service_details USING (group_id) LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS petition_id,status,type, service_id,comment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,deleted,owned,notification,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,service_description,logo_uri,comment,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,CASE WHEN requester='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu' THEN true ELSE false END AS owned,status,type,null AS state,false AS deleted, group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='eosc') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu'

13:55:35 error: syntax error at or near "AND"
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,deleted,CASE WHEN owned IS NULL THEN false ELSE owned END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,comment,group_id FROM (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu') AS group_ids LEFT JOIN (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details AND tenant='eosc') AS service_details USING (group_id) LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS petition_id,status,type, service_id,comment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,deleted,owned,notification,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,service_description,logo_uri,comment,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,CASE WHEN requester='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu' THEN true ELSE false END AS owned,status,type,null AS state,false AS deleted, group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='eosc') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu'

13:58:11 error: syntax error at or near "AND"
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,deleted,CASE WHEN owned IS NULL THEN false ELSE owned END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,comment,group_id FROM (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu') AS group_ids LEFT JOIN (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details AND tenant='eosc') AS service_details USING (group_id) LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS petition_id,status,type, service_id,comment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,deleted,owned,notification,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,service_description,logo_uri,comment,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,CASE WHEN requester='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu' THEN true ELSE false END AS owned,status,type,null AS state,false AS deleted, group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='eosc') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='4e38406c89591bb08e070accbce62140cfc8beb40314c03aa82cf3683ac270b5@aai.eosc-portal.eu'

11:24:49 error: column "description" does not exist
         query: SELECT name,logo,main_title,color,description FROM tenants WHERE name='egi'

11:24:49 error: column "description" does not exist
         query: SELECT name,logo,main_title,color,description FROM tenants WHERE name='eosc'

11:25:00 error: column "description" does not exist
         query: SELECT name,logo,main_title,color,description FROM tenants WHERE name='eosc'

13:50:37 error: column "z" does not exist
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN owned IS NULL THEN false ELSE owned END,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,deleted,comment,group_id FROM (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details WHERE tenant=z) AS service_details LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu') AS group_ids USING (group_id) LEFT JOIN (SELECT id AS petition_id,status,type,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification, service_id,comment FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu' THEN true ELSE false END AS owned,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,notification,deleted,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,comment,service_description,logo_uri,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,status,type,null AS state,false AS deleted,group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='egi') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu'

13:50:41 error: column "z" does not exist
         query: SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN owned IS NULL THEN false ELSE owned END,status,type,state,CASE WHEN group_manager IS NULL then false ELSE group_manager END,CASE WHEN notification IS NULL THEN false ELSE notification END AS notification,deleted,comment,group_id FROM (SELECT id AS service_id,service_description,logo_uri,service_name,deleted,requester,integration_environment,group_id FROM service_details WHERE tenant=z) AS service_details LEFT JOIN service_state ON service_details.service_id=service_state.id LEFT JOIN (SELECT id AS group_id,true AS owned,CASE WHEN group_manager IS NULL then false ELSE group_manager END FROM groups LEFT JOIN group_subs ON groups.id=group_subs.group_id WHERE sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu') AS group_ids USING (group_id) LEFT JOIN (SELECT id AS petition_id,status,type,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification, service_id,comment FROM service_petition_details WHERE reviewed_at IS NULL) AS petitions USING (service_id) WHERE deleted=false OR (deleted=TRUE AND state!='deployed') UNION SELECT service_id,petition_id,service_description,logo_uri,service_name,integration_environment,CASE WHEN group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu' THEN true ELSE false END AS owned,status,type,state,CASE WHEN group_manager IS NULL THEN false ELSE group_manager END,notification,deleted,comment,petitions.group_id FROM (SELECT service_id,id AS petition_id,comment,service_description,logo_uri,service_name,integration_environment,CASE WHEN service_petition_details.comment IS NOT NULL THEN true ELSE false END AS notification,status,type,null AS state,false AS deleted,group_id FROM service_petition_details WHERE reviewed_at IS NULL AND type='create' AND tenant='egi') as petitions LEFT JOIN group_subs ON petitions.group_id= group_subs.group_id AND group_subs.sub='7a6ae5617ea76389401e3c3839127fd2a019572066d40c5d0176bd242651f934@egi.eu'